---
layout: post
title: "贪吃蛇小游戏（android）"
date: 2015-05-14
tags: android 游戏
description: 原生canvas的操作!
---
<p>
	为了学习android，写了一个贪吃蛇，并没有看过谷歌的SDK中的贪吃蛇，凭着感觉写的，期间也学到了不少的知识，貌似在获取屏幕大小的时候用了过时的方法，那些以后再谈。
</p>
<p>代码：</p>
<ul>
	<li>Gameview.class</li>
</ul>
<pre class="lang-java" data-lang="java">package cn.silenttt.tcs;\n\n/**\n * Created by tt on 15-5-11.\n&nbsp;* 游戏主程序，将这个View设置为Activity就行了\n * File:GameView.class\n */\nimport android.content.Context;\nimport android.graphics.Canvas;\nimport android.graphics.Color;\nimport android.graphics.Paint;\nimport android.graphics.Rect;\nimport android.util.DisplayMetrics;\nimport android.view.Display;\nimport android.view.GestureDetector;\nimport android.view.KeyEvent;\nimport android.view.MotionEvent;\nimport android.view.View;\nimport android.view.WindowManager;\n\nimport java.util.Random;\n\npublic class GameView extends View implements Runnable {\n    /* 声明Paint对象 */\n    private Paint mPaint = null;\n    private WindowManager wm ;\n    private Random rd= new Random();\n    private int Hight,Whight,bc,x=0,y=0,fx=1,WL,HL,ex,ey,Wei,Hei;\n    private int line,df=100;\n    private Canvas cs;\n    private GestureDetector gestureDetector;\n    private boolean alive=true;\n    private int score = 0,skill=0,type;\n    private skill SK = new skill();\n    public class mL extends GestureDetector.SimpleOnGestureListener {\n        public boolean onFling(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY) {\n            float x = e2.getX() - e1.getX();\n            float y = e2.getY() - e1.getY();\n            System.out.println(x+" "+y);\n            if (Math.abs(x) &gt; Math.abs(y) ) {\n                if(x&gt;0) {\n                    if (fx != 3) {\n                        fx = 1;\n                    }\n                }\n                else {\n                    if (fx != 1) {\n                        fx = 3;\n                    }\n                }\n            } else{\n                if(y&gt;0) {\n                    if (fx != 0) {\n                        fx = 2;\n                    }\n                }\n                else {\n                    if (fx != 2) {\n                        fx = 0;\n                    }\n                }\n            }\n            return true;\n        }\n        public boolean onDoubleTap(MotionEvent e){\n            if(alive){\n                if(bodynum==0) return true;\n                SK.skillNum=bd[1].type;\n                for(int i=1;i&lt;bodynum;i++){\n                    bd[i].type=bd[i+1].type;\n                }\n                bodynum--;\n                return true;\n            }\n            else {\n                x = 0;\n                y = 0;\n                alive = true;\n                fx = 1;\n                bodynum = 0;\n                score = 0;\n                return true;\n            }\n        }\n    }\n    class body {\n        public int x,y,type;\n    }\n    private body[] bd;\n    private int bodynum=0;\n\n    public void CreadEat(){\n        ex = rd.nextInt(WL/bc)*bc+Hei/96;\n        ey = rd.nextInt(HL/bc)*bc+Hei/96;\n        type = rd.nextInt(3);\n    }\n    public GameView(Context context,WindowManager yooooo) {\n        super(context);\n        wm = yooooo;\n        Hei = wm.getDefaultDisplay().getHeight();\n        Wei = wm.getDefaultDisplay().getWidth();\n        line = Hei/48;\n        Hight = Hei*5/6;\n        Whight = Wei*25/27;\n        //Hight = wm.getDefaultDisplay().getHeight()-320;\n        //Whight = wm.getDefaultDisplay().getWidth()*25/27;80\n        WL = Whight-Wei/27-line;\n        HL = Hight-Hei/48-line;\n        bc = Hei/48;\n        CreadEat();\n        bd = new body[1000];\n        bd[0] = new body();\n\n        gestureDetector = new GestureDetector(new mL());\n        /* 构建对象 */\n        mPaint = new Paint();\n        /* 开启线程 */\n        new Thread(this).start();\n        new Thread(SK).start();\n    }\n    public void UseSkill(){\n\n    }\n    public void Draw(int x,int y,int color){\n        int sx = Hei/48,sy = Hei/48;\n        mPaint.setColor(color);\n        mPaint.setStyle(Paint.Style.FILL);\n        cs.drawRect(sx+x,sy+y,sx+x+line,sy+y+line,mPaint);\n    }\n    public void GameOver(){\n        mPaint.setTextSize(100);\n        alive=false;\n        cs.drawText("Score:"+score,Wei/4,Hei/2,mPaint);\n    }\n    public void DrawEat(int x,int y,int color){\n        int sx = Hei/48,sy = Hei/48;\n        mPaint.setColor(color);\n        mPaint.setStyle(Paint.Style.FILL);\n        cs.drawCircle(x+sx,y+sy,20,mPaint);\n    }\n    public boolean Eat(){\n        if(ex==x+Hei/96&amp;&amp;ey==y+Hei/96){\n            return true;\n        }\n        else {\n            return false;\n        }\n    }\n    public int ColorTran(int a){\n        switch (a){\n            case 0:return Color.RED;//红色有角三倍速\n            case 1:return Color.GREEN;//绿色分数*2\n            case 2:return Color.WHITE;//白色减速\n        }\n        return Color.WHITE;\n    }\n    public int  V(int score,int skill){\n        int ans=50;\n        if (score &lt; 2500) {\n            ans=300 - score / 10;\n        }\n        if (score &gt;= 2500) {\n            ans=50;\n         }\n        if(skill==-1) df=100;\n        if(skill==0) return ans/3;\n        if(skill==1) df=200;\n        if(skill==2) return ans*2;\n        return ans;\n    }\n    public void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n\n        /* 设置画布的颜色 */\n        canvas.drawColor(Color.BLACK);\n        cs=canvas;\n        /* 设置取消锯齿效果 */\n        mPaint.setAntiAlias(true);\n\n        /* 设置裁剪区域 */\n\n        /* 线锁定画布 */\n        canvas.save();\n        /* 旋转画布 */\n        //canvas.rotate(45.0f);\n\n        /* 设置颜色及绘制矩形 */\n        mPaint.setTextSize(Hei/48);\n        mPaint.setColor(Color.YELLOW);\n        canvas.drawRect(new Rect(), mPaint);\n        cs.drawText("Score:"+score+" V="+V(score,SK.skillNum),Wei/4,80,mPaint);\n\n        /* 解除画布的锁定 */\n        canvas.restore();\n        if(Eat()){\n            if(bodynum==0){\n                bd[0]=new body();\n                bd[0].x=x;\n                bd[0].y=y;\n            }\n            score+=df;\n            bodynum++;\n            bd[bodynum]=new body();\n            bd[bodynum].x=ex-Hei/96;bd[bodynum].y=ey-Hei/96;bd[bodynum].type=type;\n            CreadEat();\n        }\n        for(int i=bodynum;i&gt;=0;i--){\n            if(i==0){\n                switch (fx){\n                    case 0:y-=bc;break;\n                    case 1:x+=bc;break;\n                    case 2:y+=bc;break;\n                    case 3:x-=bc;break;\n                }\n                bd[i].x=x;bd[i].y=y;\n                Draw(x,y,Color.YELLOW);\n            }\n            else{\n                if(bd[i].x!=bd[i-1].x||bd[i].y!=bd[i-1].y) {\n                    bd[i].x = bd[i - 1].x;\n                    bd[i].y = bd[i - 1].y;\n                    DrawEat(bd[i].x+Hei/96, bd[i].y+Hei/96, ColorTran(bd[i].type));\n                }\n            }\n        }\n        if(x&gt;WL||x&lt;0||y&gt;HL||y&lt;0){\n            GameOver();\n        }\n        DrawEat(ex,ey,ColorTran(type));\n        /* 设置颜色及绘制另一个矩形 */\n        mPaint.setColor(Color.GREEN);\n        mPaint.setStyle(Paint.Style.STROKE);\n        canvas.drawRect(new Rect(Hei/48,Hei/48,Whight,Hight), mPaint);\n    }\n\n    // 触笔事件\n    public boolean onTouchEvent(MotionEvent event) {\n        gestureDetector.onTouchEvent(event);\n        return true;\n    }\n\n    // 按键按下事件\n    public boolean onKeyDown(int keyCode, KeyEvent event) {\n        return true;\n    }\n\n    // 按键弹起事件\n    public boolean onKeyUp(int keyCode, KeyEvent event) {\n        return false;\n    }\n\n    public boolean onKeyMultiple(int keyCode, int repeatCount, KeyEvent event) {\n        return true;\n    }\n\n    public void run() {\n        while (true) {\n            try {\n                Thread.sleep(V(score,SK.skillNum));\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n            // 使用postInvalidate可以直接在线程中更新界面\n            if(alive) postInvalidate();\n        }\n    }\n}\n\n</pre>
<ul>
	<li>MainActivity.class</li>
</ul>
<pre class="lang-java" data-lang="java">package cn.silenttt.tcs;\n\nimport android.content.Intent;\nimport android.support.v7.app.ActionBarActivity;\nimport android.os.Bundle;\nimport android.view.Menu;\nimport android.view.MenuItem;\nimport android.view.WindowManager;\n\n\npublic class MainActivity extends ActionBarActivity {\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        WindowManager wm = this.getWindowManager();\n        GameView a = new GameView(this,wm);\n        setContentView(a);\n    }\n\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        // Inflate the menu; this adds items to the action bar if it is present.\n        getMenuInflater().inflate(R.menu.menu_main, menu);\n        return true;\n    }\n\n    @Override\n    public boolean onOptionsItemSelected(MenuItem item) {\n        // Handle action bar item clicks here. The action bar will\n        // automatically handle clicks on the Home/Up button, so long\n        // as you specify a parent activity in AndroidManifest.xml.\n        int id = item.getItemId();\n\n        //noinspection SimplifiableIfStatement\n        if (id == R.id.action_settings) {\n            return true;\n        }\n\n        return super.onOptionsItemSelected(item);\n    }\n}\n\n</pre>
<p>APK下载地址：</p>
<p>
	<a href="http://pan.baidu.com/s/1kTiSTvh" target="_blank">点我下载</a>
	<br></p>